name: Windows-RDP-Anyview
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    env:
      RDP_USER: ${{ secrets.RDP_USER }}
      RDP_PASS: ${{ secrets.RDP_PASS }}

    steps:
    - name: Enable RDP
      run: |
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

    - name: Set RDP User Password
      run: |
        net user $env:RDP_USER $env:RDP_PASS /add
        net localgroup administrators $env:RDP_USER /add

    - name: Download Anyview
      run: |
        Invoke-WebRequest `
          -Uri "https://download.anyviewer.com/update/AnyViewer_Setup.exe" `
          -OutFile "AnyViewer_Setup.exe"

    - name: Install Anyview Silently
      run: |
        Start-Process -Wait -FilePath .\AnyViewer_Setup.exe -ArgumentList "/silent"

    - name: Show Connection Information
      run: |
        $ip = (Invoke-WebRequest -uri "http://ipinfo.io/ip").Content.Trim()
        Write-Host "============================="
        Write-Host " ðŸŽ¯ RDP:"
        Write-Host "   âž¤  $ip:3389"
        Write-Host "   âž¤  User: $env:RDP_USER"
        Write-Host "   âž¤  Pass: $env:RDP_PASS"
        Write-Host ""
        Write-Host " ðŸŽ¯ Anyview Ä‘Ã£ Ä‘Æ°á»£c cÃ i."
        Write-Host "   âž¤ HÃ£y má»Ÿ Anyview trÃªn mÃ¡y vÃ  táº¡o tÃ i khoáº£n / Ä‘Äƒng nháº­p."
        Write-Host "============================="